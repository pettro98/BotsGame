#pragma once

#include "General.h"
#include "Hex.h"
#include "IFullAccess.h"
#include "Player.h"
#include <list>


namespace game_module
{
	/*!
	\brief ����� �����������.
	- � ������ ������������ API ��� �������� �����.
	- ������ ��� ������, ������������ � ����������� - ����������.
	*/
	class Controller
	{
	private:
		/*!
		\brief ��������� �� ������ ����������� �������� � �������� ����������� ������ ����.
		*/
		IFullAccess * MyAccess;
	public:
		/*!
		\brief ���������� �� ���������.
		*/
		~Controller() = default;
		/*!
		\brief �����������.

		\param my_access ��������� �� ������, ������� ���������������� ���� MyAccess ������� ������.
		*/
		Controller(IFullAccess * my_access);
		/*!
		\brief ����� ���������� ���� ����� � ����������� ������������.
		- � ������ ���� ����� � ������ ������������ ��� ���������� ���� black.

		\param hex ���������� �����, ��� ���� �������������.
		*/
		hex_color color(const Pair & hex) const;
		/*!
		\brief ����� ���������� ���������� ������� �������, ������� ����������� 
		���� � ����������� ������������.
		- � ������ ���� ����� � ������ ������������ ��� ���������� ���� (0, 0).

		\param hex ���������� �����, ��� ������� �������������.
		*/
		Pair capital(const Pair & hex) const;
		/*!
		\brief ����� ���������� ��������� ����� ����� �������.
		- ��������� ����� ����� ������� ���� �����������, ���-�� ������ ������� ����� "������",
		����� ������� �� ������ � ������.
		- "������" �� ������� ����� ����� ������ � �������� ���.
		- ��������� ������� ���������� ����� ������� ����� �����.
		- ���������� ����� ����� ��������� ������� ����� 1, ���������� ����� ������ � �� ����� ����� 0.
		- ��� ������� ��������� ������������ ������� get_distance. 

		\param hex1 ���������� ������� �����, ��� �������� ������������ ������ ���������.
		\param hex2 ���������� ������� �����, ��� �������� ������������ ������ ���������.
		*/
		size_type distance(const Pair & hex1, const Pair & hex2) const;
		/*!
		\brief ����� ���������� ��� �����, ����������� � ����� � ����������� ������������.
		- � ������ ���� ����� � ������ ������������ ��� ���������� ��� none.

		\param hex ���������� �����, ��� ��� ����� �������������.
		*/
		unit_type get_type(const Pair & hex) const;
		/*!
		\brief ����� ���������� ���� �����, ����������� � ����� � ����������� ������������.
		- � ������ ���� ����� � ������ ������������ ��� ���������� 0.

		\param hex ���������� �����, ��� ���� ����� �������������.
		*/
		size_type get_unit_strength(const Pair & hex) const;
		/*!
		\brief ����� ���������� ���� ����� � ����������� ������������.
		- ���� ����� ��� ���������� �������� �� ��� ������, ���������� � ������ ����� ���  
		��� ������� � ��� �� ������, ��� � � ������� �����.
		- � ������ ���� ����� � ������ ������������ ��� ���������� 0.

		\param hex ���������� �����, ��� ���� ����� �������������.
		*/
		size_type get_hex_strength(const Pair & hex) const;
		/*!
		\brief ����� ���������� ���� Moved ����� ����������� � ����� � ����������� ������������.
		- � ������ ���� ����� � ������ ������������ ��� ��� � ���� ��������� �� ����� ���������� true.

		\param hex ���������� �����, ������� ������ ������������ �����.
		*/
		bool get_moved(const Pair & hex) const;
		/*!
		\brief ����� ���������� ������ �������, � ������� ��������� ���� � ����������� ������������.
		- � ������ ���� ����� � ������ ������������ ��� ��� ���� �� ����������� ������� ���������� 0.

		\param hex ���������� �����, ������������ � ������������ �������.
		*/
		size_type get_district_money(const Pair & hex) const;
		/*!
		\brief ����� ���������� ����� �������, � ������� ��������� ���� � ����������� ������������.
		- � ������ ���� ����� � ������ ������������ ��� ��� ���� �� ����������� ������� ���������� 0.

		\param hex ���������� �����, ������������ � ������������ �������.
		*/
		size_type get_district_income(const Pair & hex) const;
		/*!
		\brief ����� ���������� ���-�� ���� �������, � ������� ��������� ���� � ����������� ������������.
		- � ������ ���� ����� � ������ ������������ ��� ��� ���� �� ����������� ������� ���������� 0.

		\param hex ���������� �����, ������������ � ������������ �������.
		*/
		size_type get_farms_number(const Pair & hex) const;
		/*!
		\brief ����� ���������� ��� ������� �����, ������������ � ������ ����.
		*/
		std::string get_map_type() const;
		/*!
		\brief ����� ���������� ���-�� ����� ������� �����, ������������ � ������ ����.
		*/
		size_type get_map_dimension_x() const;
		/*!
		\brief ����� ���������� ���-�� �������� ������� �����, ������������ � ������ ����.
		*/
		size_type get_map_dimension_y() const;
		/*!
		\brief ����� ���������� ���-�� �������, ����������� � ����.
		- ����� ��������� � ���� ���� ��� ����������� ���� �� ���� ������� �������.
		*/
		size_type get_players_number() const;
		/*!
		\brief ����� ���������� ����� ���� ������� ����������� � ����.
		- ����� ��������� � ���� ���� ��� ����������� ���� �� ���� ������� �������.
		*/
		std::vector<hex_color> get_players_colors() const;
		/*!
		\brief ����� ���������� ��� ���������� ������ �������� ������ ����������� �����.

		\param color ���� ������������� ������.
		*/
		std::list<Pair> get_player_capitals(hex_color color) const;
		/*!
		\brief ����� ���������� ����� �������� �������� ����.
		*/
		size_type get_current_turn() const;
		/*!
		\brief ����� ���������� ����������� ��������� ���-�� ������� ����� � ������ ����.
		*/
		size_type get_max_turns() const;
		/*!
		\brief ����� �������� ����� �� ���� �� ����� � ����������� ������������ ������������� 
		� ���� � ����������� ������������.
		- ���� moved ����� � ������ �� �����������. 

		\param hex1 ���������� ����� ������ ������������ ������������ ����
		\param hex2 ���������� ����� ���� ������������ ������������ ����
		\param move_points ���-�� ����� ������������, ������� ����� ����� �� �����������.
		�������� �� ��������� Army::move_points().
		*/
		bool can_move(const Pair & hex1, const Pair & hex2,
			size_type move_points = Army::move_points()) const;
		/*!
		\brief ����� �������� �������� �� ��������� ����� �� ���� � ����������� ������������.
		- ���� ���� ����� �� ��������� � ������ �������� ������ ���������� false. 

		\param hex ���������� ����� ���� ������������ �������� ����.
		*/
		bool can_place_tower(const Pair & hex) const;
		/*!
		\brief ����� �������� �������� �� ��������� ����� �� ���� � ����������� ������������.
		- ���� ���� ����� �� ��������� � ������ �������� ������ ���������� false.

		\param hex ���������� ����� ���� ������������ �������� ����.
		*/
		bool can_place_farm(const Pair & hex) const;
		/*!
		\brief ����� �������� �������� �� ��������� ����� ���������� ����
		�� ���� � ����������� ������������.
		- ���� ���� ����� �� ��������� � ������ �������� ������ ���������� false.

		\param hex ���������� ����� ���� ������������ �������� ����.
		\param strength ���� ������������ ��������������� �����.
		*/
		bool can_place_army(const Pair & hex, size_type strength = 1) const;
		/*!
		\brief ����� ���������� ��� ����� ���� ����� ���������� ����� � �������,
		� ������� ������ ���� � ����������� ������������.

		\param hex ���������� �����, ������� ��������� � ������������ �������.
		*/
		std::vector<Pair> hexs_to_place_farm(const Pair & hex) const;
		/*!
		\brief ����� ���������� ��� ����� ���� ����� ����������� �����
		����������� � ����� � ����������� ������������.

		\param hex ���������� ����� � ������� ��������� �����.
		*/
		std::vector<Pair> hexs_to_move_army(const Pair & hex) const;
		/*!
		\brief ����� ���������� ���� ������ ����������� ����, ����������� � �������,
		� ������� ��������� ���� � ����������� ������������.

		\param hex ���������� �����, ������������ � ������������ �������.
		\param type ��� ������, ������� ���������� �������.
		*/
		std::vector<Pair> get_district_units(const Pair & hex, unit_type type) const;
		/*!
		\brief ����� ���������� ���� ��������� ������, ����������� � �������,
		� ������� ��������� ���� � ����������� ������������.
		- ���������� ������� ��������� ����: palm, pine, grave.

		\param hex ���������� �����, ������������ � ������������ �������.
		*/
		std::vector<Pair> get_district_static(const Pair & hex) const;
		/*!
		\brief ����� ���������� ��� �����, ����������� � �������,
		� ������� ��������� ���� � ����������� ������������.

		\param hex ���������� �����, ������������ � ������������ �������.
		*/
		std::vector<Pair> get_army_list(const Pair & hex) const;
		/*!
		\brief ����� �������� ��������� �� ���� � ����������� ������������ � ������-���� ������������� �����,
		���������������� ���������� ��������.
		- �����������, ������������� �� ���� � ��� ����� ��������� ����� ����������� ��������.
		- ��� �������� ������������ ������� ������ ���������� (std::functional) compare1, compare2.
		- ����� ����� black ��� �� ��������� �������� ������� hex_exist �������� �� ������������.
		- ���� ��� ������������� ��������� ����� � ���� ������ ������
		����� ������� �����, ��������� ������ ���������� ������� �����.
		- ���� ���� ������������� ��������� ������ ��� ����� �����,
		�� �� ��� ����, �� ��� �������� compare1 ����� �������� ��� ������� is_color.

		\param hex ���������� ������������ �����.
		\param compare1 ������� ������ ����������, ����������� ���� �����.
		�������� �� ��������� ������� ������ ���������� ����������� true.
		\param compare2 ������� ������ ����������, ����������� ��� ����� �����.
		�������� �� ��������� ������� ������ ���������� ����������� true.
		*/
		bool get_neighbours_exist(const Pair & hex,
			std::function <bool(hex_color)> compare1 = is_color,
			std::function <bool(unit_type)> compare2 = is_type) const;
		/*!
		\brief ����� ���������� ��� ������������ � ����������� � ����� � ����������� ������������ �����,
		��������������� ���������� ��������.
		- �����������, ������������� �� ���� � ��� ����� ��������� ����� ����������� ��������.
		- ��� �������� ������������ ������� ������ ���������� (std::functional) compare1, compare2.
		- ����� ����� black ��� �� ��������� �������� ������� hex_exist 
		�������� �� ������������ � �� ����� ���� ����������.
		- ���� ��� ������������� ��������� ����� � ���� ������ ������
		����� ������� �����, ��������� ������ ���������� ������� �����.
		- ���� ���� ������������� ��������� ������ ��� ����� �����, �� �� ��� ����, �� ��� �������� compare1 �����
		�������� ��� ������� is_color.

		\param hex ���������� ������������ �����.
		\param compare1 ������� ������ ����������, ����������� ���� �����.
		�������� �� ��������� ������� ������ ���������� ����������� true.
		\param compare2 ������� ������ ����������, ����������� ��� ����� �����.
		�������� �� ��������� ������� ������ ���������� ����������� true.
		*/
		std::vector<Pair> get_neighbours(const Pair & hex,
			std::function <bool(hex_color)> compare1 = is_color,
			std::function <bool(unit_type)> compare2 = is_type) const;
		/*!
		\brief ����� ���������� ��� ������������ �����, ��������������� ���������� ��������
		� ����������� �� ��������� ���������� �� ����� � ����������� ������������.
		- �����������, ������������� �� ���� � ��� ����� ����� ����������� ��������.
		- ��� �������� ������������ ������� ������ ���������� (std::functional) compare1, compare2.
		- ����� ����� black ��� �� ��������� �������� ������� hex_exist �������� �� ������������ � �� ����� ���� ����������.
		- ���� ��� ������������� ��������� ����� � ���� ������ ������
		����� ������� �����, ��������� ������ ���������� ������� �����.
		- ���� ���� ������������� ��������� ������ ��� ����� �����, �� �� ��� ����, �� ��� �������� compare1 �����
		�������� ��� ������� is_color.

		\param hex ���������� ������������ �����.
		\param radius ����������, �� ������� ������ ���������� ������������ ����� �� ����� � ����������� ������������.
		\param compare1 ������� ������ ����������, ����������� ���� �����.
		�������� �� ��������� ������� ������ ���������� ����������� true.
		\param compare2 ������� ������ ����������, ����������� ��� ����� �����.
		�������� �� ��������� ������� ������ ���������� ����������� true.
		*/
		std::vector<Pair> get_hex_row(const Pair & hex, size_type radius,
			std::function <bool(hex_color)> compare1 = is_color,
			std::function <bool(unit_type)> compare2 = is_type) const;
		/*!
		\brief ����� �������� ���� �� ������������ ����, ��������������� ���������� ��������
		� ����������� �� ��������� ���������� �� ����� � ����������� ������������.
		- �����������, ������������� �� ���� � ��� ����� ����� ����������� ��������.
		- ��� �������� ������������ ������� ������ ���������� (std::functional) compare1, compare2.
		- ����� ����� black ��� �� ��������� �������� ������� hex_exist �������� �� ������������.
		- ���� ��� ������������� ��������� ����� � ���� ������ ������
		����� ������� �����, ��������� ������ ���������� ������� �����.
		- ���� ���� ������������� ��������� ������ ��� ����� �����, �� �� ��� ����, �� ��� �������� compare1 �����
		�������� ��� ������� is_color.

		\param hex ���������� ������������ �����.
		\param radius ����������, �� ������� ������ ���������� ������������ ����� �� ����� � ����������� ������������.
		\param compare1 ������� ������ ����������, ����������� ���� �����.
		�������� �� ��������� ������� ������ ���������� ����������� true.
		\param compare2 ������� ������ ����������, ����������� ��� ����� �����.
		�������� �� ��������� ������� ������ ���������� ����������� true.
		*/
		bool get_hex_row_exist(const Pair & hex, size_type radius,
			std::function <bool(hex_color)> compare1 = is_color,
			std::function <bool(unit_type)> compare2 = is_type) const;
		/*!
		\brief ����� ���������� ��� ����� ���������� ������� �������, ��������������� ����������� �������
		� ����������� � ��� �� ������� ��� � ���� � ����������� ������������.
		- ���������� �������� ������� ��������� ��� ����� ���� �������, ������� ����� ���� �� ������ ������������� ������
		����� �� black � �� ����� ��������� ������ �������.
		- ���� ���� � ����������� ������������ �� ����������� ������� (��������� �� ������� ������� ����� nullptr),
		����� ���������� false.
		- �����������, ������������� �� ��� ����� ����� ����������� ��������.
		- ��� �������� ������������ ������� ������ ���������� (std::functional) compare.
		- ����� ����� black ��� �� ��������� �������� ������� hex_exist �������� �� ������������ � �� ����� ���� ����������

		\param hex ���������� ������������ �����.
		\param compare ������� ������ ����������, ����������� ��� ����� �����.
		�������� �� ��������� ������� ������ ���������� ����������� true.
		*/
		std::vector<Pair> get_internal_border(const Pair & hex,
			std::function <bool(unit_type)> compare = is_type) const;
		/*!
		\brief ����� ���������� ��� ����� ������� ������� �������, ��������������� ����������� �������
		� ����������� � ��� �� ������� ��� � ���� � ����������� ������������.
		- ������� �������� ������� ��������� ��� �����, ������� ����� ���� �� ������ ������������� ������,
		�������������� ������ �������.
		- ���� ���� � ����������� ������������ �� ����������� ������� (��������� �� ������� ������� ����� nullptr),
		����� ���������� false.
		- �����������, ������������� �� ��� ����� ����� ����������� ��������.
		- ����� ����� black ��� �� ��������� �������� ������� hex_exist �������� �� ������������ � �� ����� ���� ����������.
		- ���� ��� ������������� ��������� ����� � ���� ������ ������
		����� ������� �����, ��������� ������ ���������� ������� �����.
		- ���� ���� ������������� ��������� ������ ��� ����� �����, �� �� ��� ����, �� ��� �������� compare1 �����
		�������� ��� ������� is_color.

		\param hex ���������� ������������ �����.
		\param compare1 ������� ������ ����������, ����������� ���� �����.
		�������� �� ��������� ������� ������ ���������� ����������� true.
		\param compare2 ������� ������ ����������, ����������� ��� ����� �����.
		�������� �� ��������� ������� ������ ���������� ����������� true.
		*/
		std::vector<Pair> get_external_border(const Pair & hex,
			std::function <bool(hex_color)> compare1 = is_color,
			std::function <bool(unit_type)> compare2 = is_type) const;
		/*!
		\brief ����� ���������� ��� ����� �������, � ������� ������ ���� � ����������� ������������
		� ������� ������������� ����������� �������.
		- ������ ����� ��������� ��������� �� ������� ������� �����, ����� ������ ����������� �� �� ��.
		- ����� ����� ��������� �� ��������� � ������� solve_maze.
		- �����������, ������������� �� ���� ����� ����������� ��������.
		- ��� �������� ������������ ������� ������ ���������� (std::functional) compare.
		- ����� ����� black ��� �� ��������� �������� ������� hex_exist �������� �� ������������ � �� ����� ���� ����������.

		\param hex ���������� ������������ �����.
		\param compare ������� ������ ����������, ����������� ��� ����� �����.
		�������� �� ��������� ������� ������ ���������� ����������� true.
		*/
		std::vector<Pair> easy_solve_maze(const Pair & hex,
			std::function <bool(unit_type)> compare = is_type) const;
		/*!
		\brief ����� ���������� ���-�� ������ �������, � ������� ������ ���� � ����������� ������������
		� ������� ������������� ����������� �������.
		- ������ ����� ��������� ��������� �� ������� ������� �����, ����� ������ ����������� �� �� ��.
		- �����������, ������������� �� ���� � ��� ����� ����� ����������� ��������.
		- ��� �������� ������������ ������� ������ ���������� (std::functional) compare.
		- ����� ����� black ��� �� ��������� �������� ������� hex_exist �������� �� ������������ � �� ����� ���� ����������.

		\param hex ���������� ������������ �����.
		\param compare ������� ������ ����������, ����������� ��� ����� �����.
		�������� �� ��������� ������� ������ ���������� ����������� true.
		*/
		size_type easy_solve_maze_count(const Pair & hex,
			std::function <bool(unit_type)> compare = is_type) const;
		/*!
		\brief ����� ���������� ���� ������� ����� � �������,
		� ������� ������ ���� � ����������� ������������.

		\param hex ���������� �����, ������������ � ������������ �������.
		*/
		size_type get_farm_cost(const Pair & hex) const;
		/*!
		\brief ����� ���������� ���� ������� ����� ���������� ����.
		- ���� ���������� ���� ����� ������������ �������� ���������� 0.

		\param strength ���� �����, ���� ������� ������� ����������.
		�������� �� ��������� 1.
		*/
		size_type get_army_cost(size_type strength = 1) const;
		/*!
		\brief ����� ���������� ���� ������� ����� ���������� ����.
		- ���� ���������� ���� ����� ������������ �������� ���������� 0.

		\param strength ���� �����, ���� ������� ������� ����������.
		�������� �� ��������� 2.
		*/
		size_type get_tower_cost(size_type strength = 2) const;
		/*!
		\brief ����� ��������� ����������� ����� ����������� � ����� � ����������� ������������
		� ���� � ����������� ������������ ���� ��� ��������.
		- ����� ���������� true ���� ����������� ���� ����������.
		- ���� ���� �����, ������ ���������� �����������, �� ��������� � ������ ���������� ������ ������
		���������� false.

		\param start ���������� ����� ������ ���������� �����������.
		\param end ���������� ����� ���� ���������� �����������.
		*/
		bool make_move(const Pair & start, const Pair & end);
		/*!
		\brief ����� ������������� ����� ����� ���������� ���� � ���� � ����������� ������������,
		���� ��� ��������.
		- ����� ���������� true ���� ��������� ���� ����������.
		- ���� ���� �����, ���� ���������� ��������� �����, �� ��������� � ������ ���������� ������ ������
		���������� false.

		\param hex ���������� ����� ���� ��������������� ����� ����.
		\param strength ���� �����, ��������� � �������.
		�������� �� ��������� 2.
		*/
		bool buy_tower(const Pair & hex, size_type strength = 2);
		/*!
		\brief ����� ������������� ����� ����� � ���� � ����������� ������������,
		���� ��� ��������.
		- ����� ���������� true ���� ��������� ���� ����������.
		- ���� ���� �����, ���� ���������� ��������� �����, �� ��������� � ������ ���������� ������ ������
		���������� false.

		\param hex ���������� ����� ���� ��������������� ����� ����.
		*/
		bool buy_farm(const Pair & hex);
		/*!
		\brief ����� ������������� ����� ����� ���������� ���� � ���� � ����������� ������������,
		���� ��� ��������.
		- ����� ���������� true ���� ��������� ���� ����������.
		- ���� ���� �����, ���� ���������� ��������� �����, �� ��������� � ������ ���������� ������ ������
		���������� false.

		\param hex ���������� ����� ���� ��������������� ����� ����.
		\param strength ���� �����, ��������� � �������.
		�������� �� ��������� 1.
		*/
		bool buy_army(const Pair & hex, size_type strength = 1);
	private:
		/*!
		\brief ����� ���������� ��������� �� ����, ����������� � ����� � ����������� ������������.
		- � ������ ���� ����� � ������ ������������ ��� ���������� nullptr.

		\param hex ���������� ����� ��� ���� �������������.
		*/
		Unit * get_unit(const Pair & hex) const;
		/*!
		\brief ����� ���������� ��������� �� ������� �������, � ������� ��������� ����
		� ����������� ������������.
		- � ������ ���� ����� � ������ ������������ ��� ���������� nullptr.

		\param hex ���������� ����� ��� ������� ������� �������������.
		*/
		Capital * get_capital(const Pair & hex) const;
		/*!
		\brief ����� ��������� ���-�� ������ � �������, � ������� ��������� ����
		� ����������� ������������ � ������������ ���.

		\param hex ���������� �����, ������������ � ������������ �������.
		*/
		void correct_capital(const Pair & hex);
		/*!
		\brief ����� ���������� ��� �����, ����������� � ��������, 
		� ������� ���������� �������� ��������� ������ �� �������������, ��� ���� 
		� ����������� ������������ ������ ��� ������ ��������� � ���������� ������ �� ������.

		\param hex ���������� �����, ������� ������ ��� ������ ���������.
		\param color ���� ����������� ��������� �����.
		*/
		std::vector<std::set<Pair>> hexs_to_correct(const Pair & hex, hex_color color) const;
		/*!
		\brief ����� ��������� ����� ���������� �������.

		\param district ������ �� ������ � ������� �������.
		*/
		void calculate_income(const std::vector<Pair> & district);
		friend class Game;
	};
}
